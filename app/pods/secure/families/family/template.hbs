{{#with @model.family as |family|}}
  <Modal @id="family">
    <h1>{{family.namePlural}}</h1>
    <h2>Properties</h2>

    <Field::String
      @label='Name (plural)'
      @record={{family}}
      @attribute='namePlural'
    />

    <Field::String
      @label='Name (singular)'
      @record={{family}}
      @attribute='nameSingle'
    />

    <Field::OneToMany
      @label="This product family is a subset of ..."
      @baseRecord={{family}}
      @baseLabel='productFamily'
      @targetModel="product-family"
      @targetFilter="namePlural"
      @targetRoute="secure.families.family"
      @minKeyStrokes='0'
    />

    <Field::String
      @label='Short explanation'
      @legend='Explain in less than 160 words and 7 seconds to a layman what this type of product is and what is commonly used for.'
      @record={{family}}
      @attribute='gist'
      @multiline='true'
    />

    <Field::String
      @label='Long explanation'
      @legend='Explain in full length what this product family is, what is used for and how to recognise a quality (aka how to recognise Interflux). Attempt to speak to a layman at first, but progressively get more technical for the experts.'
      @record={{family}}
      @attribute='theFullMonty'
      @multiline='true'
    />

    <Field::String
      @label='Rank on website'
      @legend='Use numbers to indicate how you would want to rank the product families on the website. 1 goes to the top, 9 to the bottom.'
      @record={{family}}
      @attribute='rank'
    />

    <h2>Relations</h2>

    <Field::ManyToOne
      @label="Products"
      @legend="All products belonging to {{family.namePlural}}."
      @baseRecord={{family}}
      @baseLabel='products'
      @targetModel='product'
      @targetLabel='name'
      @targetRank='rankAmongFamily'
      @targetForeignId='productFamily'
      @targetRoute='secure.products.product'
    />

    {{#if family.isMainFamily}}
      <h2>Images</h2>

      <Field::ManyToMany
        @label="The 4 avatars"
        @legend="On the product overview page we show 4 images to represent this product family."
        @baseRecord={{family}}
        @baseModel="productFamily"
        @baseLabel="productFamilyImages"
        @joinModel="product-family-image"
        @joinRankKey="rankAmongImages"
        @targetModel="image"
        @targetLabel="alt"
        @targetRoute='secure.images.image'
        @disabled={{this.maxAvatarCountReached}}
      />

      <Fieldset>
        <ul class="images">
          {{#each this.sortedImages as |joinRecord|}}
            <li>
              <p>{{joinRecord.rankAmongImages}}</p>
              <ResponsiveImage @image={{joinRecord.image}} />
            </li>
          {{/each}}
        </ul>
      </Fieldset>
    {{/if}}

    <h2>Database</h2>

    <Field::String
      @label='Database ID'
      @record={{family}}
      @attribute='slug'
      @afterSave={{this.redirect}}
    />
  </Modal>
{{/with}}